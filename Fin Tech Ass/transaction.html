<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="fontawesome-free-6.1.1-web/css/all.css">
    <!-- <script src="import.js"></script> -->
    <script src="chart.js"></script>
    <script src="bootstrap-5.1.3-dist/bootstrap-5.1.3-dist/js/bootstrap.js"></script>
    <link rel="stylesheet" href="bootstrap-5.1.3-dist/bootstrap-5.1.3-dist/css/bootstrap.css">
   
</head>
<body>
    <div class="container-fluid">
    
        <div class="flexs row " style="position: sticky; top: 0;">
        <nav class="navbar navbar-expand-sm navbar-dark ">
           
           <div class=" col-2  col-md-2 col-sm-2 mt-1">
             <span  style="margin-left:10px;">
                <img style="width:50px;height:50px;" src="money bag3.png" alt="">
                <span>MoneyBag</span>
            </span>
           
            </div>
            
               
        <div class="col-4 col-md-1 col-sm-4">
             <button  style="margin-left:80px;"class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
                <span class="navbar-toggler-icon"></span>
              </button>
        </div>
        <div class=" col-9 col-sm-6 col-md-9 collapse navbar-collapse" id="mynavbar">
            <input class="search w-50 w-md-75 w-sm-50" type="search" placeholder="search"><i  class="fa-solid fa-search shadow "></i>
            <nav  class="navbar-nav me-auto sticky-top"style="">
            <a class="nav-link"style="color:white;text-decoration:none;" href="Dashboard.html">
                <div class="links">Dashboard</div>
            </a><br>
           <a class="nav-link"style="color:white;text-decoration:none;"href="transaction.html">
             <div class="links link-danger">Transactions</div>
            </a><br>
            <a class="nav-link" style="color:white;text-decoration:none;" href="password.html">
                <div class="links">Change Password</div>
            </a><br>
            <a class="nav-link"style="color:white;text-decoration:none;" href="transfer.html">
                <div class="links">Transfer</div>
            </a><br>
            
         </nav>
                <button onclick="logout()" style="color:grey;margin-left:10px;text-decoration:none ;" class="border-0 bg-transparent">
            <a style="color:burlywood;text-decoration:none;" href="index.html">Log Out</a>
                 </button>
            </div>
       
        </nav>
        
        </div>
        
            <div class="row">
             <form name="form1" method="get" action="Dashboard.html">
            <div id="name" style="background-color:aliceblue; color:black;width:100%;height:100px;margin-top:10px;"> 
                <br><span id="hello" style="font-size:30px;margin-left:10px;">Hello</span>
            </div>
            </form>
            </div>
        <div class="row">
        <div class="col-12 col-md-7 col-sm-12">
           <br>
           
            <div class=" mt-5 mx-auto">
                <div class="row">
                    <div class="col-8 mx-auto shadow mt-5 p-5">
                        <div>
                            <h3>Transaction History</h3>
                            
                            <div id="hist">
    
                            </div>
                   
                   
                  
                    
                        </div>
                </div>
                </div>
    
            
             </div>
        </div>
    
      
        <div class="col-12  col-md-5 col-sm-12">
            <div>
                <br>
                <span id="title"></span>
        <canvas id="debit" style="width:500px;height:400px;"></canvas>
            </div>
        </div>
        </div>
        </div>

    
    <script>
        // to transfer money
        var keep='';
        var i=0;
        var set;
        var take=JSON.parse(localStorage.getItem("Database2"));
        var sake=JSON.parse(localStorage.getItem("Database"));
        let obj = sake.find(o => o.username === take[i].username);
                    let q=sake.indexOf(obj);
                    hist.innerHTML="";
            
        if (!JSON.parse(localStorage.getItem("Database2"))) {
            alert("not logged in yet")
            window.location="signIn.html"
        }
        function logout(){
            confirm('are you sure you want to Log out?')
            localStorage.removeItem('Database2')
            localStorage.removeItem('DatabaseAcc')
        }
                         dataset=[];
                         localStorage.setItem("DatabaseAcc",JSON.stringify(dataset));   
                         if (hist.innerHTML==""&&sake[q].transaction) {
                        for (let i = 0; i < sake[q].transaction.length; i++) {
                                            
                            hist.innerHTML+=`<div id="dele${i}"><div  class=" p-2 bg-light rounded">
                                <small>${sake[q].transaction[i].action}</small><br>
                                <small>${sake[q].transaction[i].partner}</small><br>
                                <small>Account No: ${sake[q].transaction[i].acc}</small><br>
                                <small>Amount:<i  class="fa-solid fa-naira-sign"></i>${sake[q].transaction[i].amt}</small><br>
                                <small>Description:${sake[q].transaction[i].desc}</small><br>
                                <small>Balance:<i  class="fa-solid fa-naira-sign "></i>${sake[q].transaction[i].accBalance}</small><br>
                                <small>${sake[q].transaction[i].time}</small><br>
                                <br>
                                <button  onclick="del(${i})"style="width:50px!important;font-size:12px!important;height:30px!important; " class="btn  bg-danger p-0  mb-2 me-2 bottom-0 fs-6">delete</button>
                               
                                </div>
                                </div><br>`
                        }
                        
                    }
    
                    for (let i = 0; i < take.length; i++) {
                
        hello.innerHTML+= " "+take[i].username;
        }
       
        function del(i){
            var get="dele"+i;
            confirm("Are you sure you want to delete this record?")
            sake[q].transaction.splice(i,1)
            localStorage.setItem("Database",JSON.stringify(sake));
            document.getElementById(get).innerHTML=" ";
        }
        const ctx = document.getElementById('debit').getContext('2d');
        var dataset=[5000,];
        
        var titleTopics=`<h3>Balance History <hr></h3>`;
       title.innerHTML=titleTopics;
       var set;
       var timeArr=[];
        
        localStorage.removeItem('databaseAcc')
          localStorage.setItem("DatabaseAcc",JSON.stringify(dataset));   
         if (sake[q].transaction) {
             for (let i = 0; i < sake[q].transaction.length; i++) {
                                            
                var file;
                var time;
                    file=sake[q].transaction[i].accBalance;
                    time=sake[q].transaction[i].time;
                    set=JSON.parse(localStorage.getItem("DatabaseAcc"));
                    timeArr.push(time)
                    set.push(file); 
                   // alert(set);
                    localStorage.setItem("DatabaseAcc",JSON.stringify(set));
                    set=JSON.parse(localStorage.getItem("DatabaseAcc"));}}
      
       
        
        //var data2=[12,13,45,23,56,12,13,45,23,56,12,3];
        var month=timeArr;
         new Chart("debit",{
         type:"line",
         data:{
             labels:month,
             
             datasets: [{
                 data:set,
                 backgroundColor:'blue',
                 borderColor:'white',
                 fill:true,
             },
           ]
         },
         options:{
                legend:{display:false},
                  title:{
                      display:true},
                  scales:{
                    x: {
                        display:false,
                        gridLines: {
                        display: false
                        }
                    },
                    y: {
                        gridLines: {
                        display: false
                        }
                    }
                    } 
                } 
        })
      
      
      

    </script>
</body>
</html>